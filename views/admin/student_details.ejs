<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Detail | <%= studentDetails.student_name %></title>
    <link rel="stylesheet" href="/public/css/tailwind.css" />
    <link rel="stylesheet" href="/public/css-fontawesome/all.min.css" />
    <script src="/public/js/loadHeaderFooter.js"></script>
    <style>
      ::-webkit-scrollbar {
        width: 0;
      }

      .profile-details th,
      .profile-details td {
        border: 1px solid #ccc;
        padding: 10px;
        text-align: left;
      }

      .profile-details th {
        background-color: #f4f4f4;
        width: 20%;
      }

      .profile-details td {
        width: 30%;
      }

      .admin-links a {
        background-color: #f4f4f4;
        padding: 10px 15px;
        border-radius: 5px;
        transition: background-color 0.2s, color 0.2s;
        border: 1px solid #ddd;
        font-weight: bold;
      }

      .admin-links a:hover {
        background-color: #333;
        color: #fff;
      }

      #delete-btn:hover {
        background-color: #a20202;
      }
    </style>
  </head>
  <body class="font-sans m-0 p-0 box-border">
    <div id="header" class="min-h-36"></div>

    <div class="fixed top-4 right-4">
      <button
        onclick="goToHistoryPage('/admin/students')"
        class="flex items-center bg-indigo-700 text-white py-2 px-4 rounded font-bold hover:bg-indigo-800"
      >
        <i class="fa-solid fa-arrow-left mr-2"></i>Back
      </button>
    </div>

    <h1 class="m-5 font-bold text-gray-800 text-3xl text-center">
      Student Details
    </h1>

    <section>
      <section class="m-5">
        <div class="p-2 text-2xl font-bold text-gray-800">Personal Details</div>
        <table class="profile-details w-full border-collapse px-2 my-5">
          <tr>
            <th>Name</th>
            <td><%= studentDetails.student_name %></td>
            <th>Roll no.</th>
            <td><%= studentDetails.rollno %></td>
            <td rowspan="3" class="p-0 align-top" style="width: auto">
              <img
                src="/public/uploads/profile_pics/<%= studentDetails.profile_pic %>"
                alt="Profile Picture"
              />
            </td>
          </tr>
          <tr>
            <th>Father's Name</th>
            <td><%= studentDetails.father_name %></td>
            <th>Date of Birth</th>
            <td><%= studentDetails.dob %></td>
          </tr>
          <tr>
            <th>Gender</th>
            <td><%= studentDetails.gender %></td>
            <th>Admission Category</th>
            <td><%= studentDetails.category %></td>
          </tr>
          <tr>
            <th>Year of Admission</th>
            <td><%= studentDetails.year_of_admission %></td>
            <th>Department</th>
            <td colspan="2"><%= studentDetails.department %></td>
          </tr>
          <tr>
            <th>Nationality</th>
            <td><%= studentDetails.nationality %></td>
            <th>Religion</th>
            <td colspan="2"><%= studentDetails.religion %></td>
          </tr>
          <tr>
            <th>Phone Number</th>
            <td><%= studentDetails.phone_no %></td>
            <th>Email</th>
            <td colspan="2"><%= studentDetails.email %></td>
          </tr>
        </table>

        <div class="p-2 text-2xl font-bold text-gray-800">Address Details</div>
        <table class="profile-details w-full border-collapse px-2 my-5">
          <tr>
            <th>Permanent Address</th>
            <td><%= studentDetails.permanent_address %></td>
            <th>Domicile State</th>
            <td><%= studentDetails.domicile_state %></td>
          </tr>
          <tr>
            <th>District</th>
            <td><%= studentDetails.district %></td>
            <th>Pin Code</th>
            <td><%= studentDetails.pin_code %></td>
          </tr>
          <tr>
            <th>Correspondence Address</th>
            <td colspan="3"><%= studentDetails.correspondence_address %></td>
          </tr>
        </table>

        <hr
          style="border: 1px dashed black; margin: 70px auto; margin-bottom: 0"
        />
        <hr
          style="
            border: 1px dashed black;

            margin-bottom: 40px auto;
          "
        />

        <div class="mx-4 my-7 flex flex-col justify-evenly text-gray-800">
          <h2 class="p-2 text-2xl font-bold">Admin Actions</h2>
          <div class="admin-links flex flex-wrap gap-4 items-center">
            <a href="/admin/student-job-details/<%= studentDetails.rollno %>"
              >View Job Details</a
            >

            <a href="/admin/marks/<%= studentDetails.rollno %>"
              >View Student Marks</a
            >

            <a href="/admin/students/edit/<%= studentDetails.rollno %>"
              >Edit Details</a
            >

            <a
              href="/admin/students/delete/<%= studentDetails.rollno %>"
              onclick="return confirmMessage()"
              id="delete-btn"
              >Delete Student</a
            >
            <button
              id="deleteButton"
              student-rollno="<%= studentDetails.rollno %>"
            >
              Delete
            </button>
          </div>
        </div>
        <br />
        <hr />

        <div class="mx-4 my-7 flex flex-col justify-evenly text-gray-800">
          <h2 class="p-2 text-2xl font-bold">Add Student Marks</h2>
          <div class="admin-links flex flex-wrap gap-4 items-center">
            <a href="/admin/add-marks/<%= studentDetails.rollno %>/1"
              >Semester I</a
            >
            <a href="/admin/add-marks/<%= studentDetails.rollno %>/2"
              >Semester II</a
            >
            <a href="/admin/add-marks/<%= studentDetails.rollno %>/3"
              >Semester III</a
            >
            <a href="/admin/add-marks/<%= studentDetails.rollno %>/4"
              >Semester IV</a
            >
            <a href="/admin/add-marks/<%= studentDetails.rollno %>/5"
              >Semester V</a
            >
            <a href="/admin/add-marks/<%= studentDetails.rollno %>/6"
              >Semester VI</a
            >
            <a href="/admin/add-marks/<%= studentDetails.rollno %>/7"
              >Semester VII</a
            >
            <a href="/admin/add-marks/<%= studentDetails.rollno %>/8"
              >Semester VIII</a
            >
          </div>
          <br />
        </div>
      </section>
    </section>

    <script>
      // Delete Student
      document
        .getElementById('deleteButton')
        .addEventListener('click', function () {
          const rollno = this.getAttribute('student-rollno');

          if (
            confirm(
              `Are you sure you want to delete student with Roll No: ${rollno}?`
            )
          ) {
            fetch(`/admin/students/delete/${rollno}`, {
              method: 'DELETE',
            })
              .then((response) => {
                if (!response.ok) throw new Error('Failed to delete student');
                return response.json();
              })
              .then((data) => {
                alert('Student deleted successfully!');
                window.location.href = '/admin/students';
              })
              .catch((error) => {
                console.error('Error:', error);
                alert('Failed to delete student.');
              });
          }
        });

      // Go To History Page
      function goToHistoryPage(targetUrl) {
        let visitedPages =
          JSON.parse(sessionStorage.getItem('visitedPages')) || [];

        // Convert all stored URLs to relative paths for comparison
        let normalizedHistory = visitedPages.map(
          (url) => new URL(url, window.location.origin).pathname
        );

        // Convert targetUrl to absolute if needed
        let normalizedTarget = new URL(targetUrl, window.location.origin)
          .pathname;

        if (normalizedHistory.includes(normalizedTarget)) {
          window.location.href = normalizedTarget; // Navigate instantly if in history
        } else {
          window.location.href = targetUrl; // If not in history, still navigate
        }
      }
    </script>
  </body>
</html>
